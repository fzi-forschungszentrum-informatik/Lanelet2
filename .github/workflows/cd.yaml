name: Lanelet2 CD

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Setup docker buildx
        id: buildx
        uses: docker/setup-buildx-action@v2

      - name: Build dependencies
        uses: docker/build-push-action@v3
        with:
          builder: ${{ steps.buildx.outputs.name }}
          tags: lanelet2:latest
          target: lanelet2_src

      - name: Do stuff inside the container
        uses: addnab/docker-run-action@v3
        with:
          image: lanelet2_src
          run: |
            source /opt/ros/noetic/setup.bash
            catkin config --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo -DPYTHON_VERSION=3.9
            catkin build
            cp -r /home/developer/workspace/devel/.private/lanelet2_python/lib/python3/dist-packages/lanelet2 lanelet2
